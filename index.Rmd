---
title: HW2 R Notebook
output: html_document
author: Sidhant Sharma
---

# Applying functions in R


### Reading data

```{r}
# install.packages('rio')
# opening a file from a url (file in Excel), name it 'fragility23'
linkGit="https://github.com/DACSS-Fundamentals/overview/raw/refs/heads/main/FSI-2023-DOWNLOAD.xlsx" # opening a file from a url (file in Excel), name it 'fragility23'

# library(rio) # package needed
fragility23=rio::import(file = linkGit) # imports the Excel file and stores it as a data frame
```

```{r}
str(fragility23) # displays the structure of the data frame
```

### Apply square root function?

```{r}
# whole DF?
# sqrt(fragility23) # would fail because sqrt() cannot be applied to non-numeric columns
```

```{r}
# several columns (only numerical)

sqrt(fragility23[,4:5]) # applies square root to columns 4 and 5
```

```{r}
# one column
sqrt(fragility23$Total)  # applies square root to the 'Total' column
```

```{r}
# one value
sqrt(fragility23$Total[1]) # applies square root to the first value of the 'Total' column
```

### Applying **sum()**:

```{r}
# sum everything
sum(fragility23[,4:5]) # sums all values in columns 4 and 5
```

```{r}
# sum by column
print(apply(fragility23[,4:5],2,sum)) # applies sum() column-wise (margin = 2)
```

```{r}
#notice
typeof(apply(fragility23[,4:5],2,sum)) # checks the data type of the result
```

If you do not see **list**, then it is a vector. ⏫

```{r}
# sum by row
print(apply(fragility23[,4:5],1,sum)) # applies sum() row-wise (margin = 1)
```

### Apply by iterating:

```{r}
print(lapply(fragility23[,4:5],sum)) # applies sum() to each column and returns a list
```

Notice output of **lapply**:

```{r}
typeof(lapply(fragility23[,4:5],sum)) # checks the type (list)
```

```{r}
class(lapply(fragility23[,4:5],sum)) # checks the class of the output
```

Notice output of **sapply**:

```{r}
print(sapply(fragility23[,4:5],sum)) # applies sum() and simplifies output to a vector
```

```{r}
class(sapply(fragility23[,4:5],sum)) # checks the class of the simplified output
```

Similarly:

```{r}
print(lapply(fragility23[,4:5],sqrt)) # applies sqrt() to each column, returns a list
```

```{r}
class(lapply(fragility23[,4:5],sqrt)) # checks the class of the list output
```

```{r}
print(sapply(fragility23[,4:5],sqrt)) # applies sqrt() and simplifies the output
```

```{r}
class(sapply(fragility23[,4:5],sqrt)) # checks the class of the simplified output
```

#### Now our own function:

```{r}
# defines a custom function
theOnesOK = function(DF_country_and_variable) {
  variable_values <- DF_country_and_variable[,2]            # extracts the second column values
  avg_value <- mean(variable_values, na.rm = TRUE)          # computes the mean, ignoring NA values
  is_above <- ifelse(variable_values > avg_value, "Above Average", "Below/At Average")    # compares values to the mean
  DF_country_and_variable$Status <- is_above                # adds a new column named 'Status'
  return(DF_country_and_variable)                           # returns the modified data frame
}

# This function labels each country as “Above Average” or “Below/At Average” based on whether its value is greater than the mean of a selected variable.

```

```{r}
theOnesOK(fragility23[,c('Country','S1: Demographic Pressures')]) # applies the function to selected columns
```

```{r}
# defines a custom function
theOnesOK2 = function(DF, DFvariable, CountryColumn='Country') {
  variable_values <- DF[,DFvariable]                             # extract the selected variable column from the data frame
  avg_value <- mean(variable_values, na.rm = TRUE)               # compute the mean of the variable (ignoring missing values)
  is_above <- ifelse(variable_values > avg_value, "Above Average", "Below/At Average")   # classify values as above or below/at the average
  newname = paste('Status_on', DFvariable)                       # create a new column name based on the variable name
  DF[,newname] <- is_above                                       # add the classification as a new column in the data frame 
  return(DF[,c(CountryColumn, newname)])                         # return only the country column and the new status column
}

#theOnesOK2 is a flexible function that lets the user choose which variable and country column to analyze and returns only the country and a dynamically named status column.

#theOnesOK assumes the variable is always in the second column, adds a fixed Status column, and returns the entire data frame.

```

```{r}
theOnesOK2(fragility23, "Total", CountryColumn = "Country")
```


```{r}
mystery=function(DF,positionsToUse,CountryColumn='Country'){
  newDF=DF[,c(CountryColumn),drop = FALSE]                 # creates a data frame with only the country column
  average='average'                                        # sets the name of the new column
  newDF[,average]=apply(DF[,positionsToUse],1,mean,na.rm = TRUE)    # computes row-wise means
  return(newDF[,c(CountryColumn,average)])                 # returns country and average columns
}

# This function computes the average of multiple columns for each country and returns a simplified summary table.
```

```{r}
mystery(fragility23,4:6)                                  # applies the mystery function to columns 4 through 6
```

### Explanation

The function theOnesOK2 analyzes a single specified numeric variable in a data frame, computes its overall mean across all countries, and then classifies each country as either “Above Average” or “Below/At Average” based on whether its value exceeds that mean, returning only the country name and the classification

The mystery function calculates a row-wise average for each country by taking the mean across multiple selected columns, producing a numeric summary score per country rather than a categorical label, and returns the country along with this computed average.
